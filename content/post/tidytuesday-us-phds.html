---
title: TidyTuesday - US PhDs
author: James Stone
date: '2019-02-19'
slug: tidytuesday-us-phds
categories:
  - TidyTuesday
  - Data Viz
tags:
  - rstats
  - TidyTuesday
  - visualisation
  - collapsibleTree
---

<script src="/rmarkdown-libs/htmlwidgets/htmlwidgets.js"></script>
<script src="/rmarkdown-libs/d3/d3.min.js"></script>
<link href="/rmarkdown-libs/collapsibleTree/collapsibleTree.css" rel="stylesheet" />
<script src="/rmarkdown-libs/collapsibleTree-binding/collapsibleTree.js"></script>


<p>For this week’s #TidyTuesday I’m going to look at the <a href="https://cran.r-project.org/web/packages/collapsibleTree/index.html">collapsibleTree</a> package and learn the basics. By picking a new package/vis-technique each week to go with each #tidyTuesday dataset it presents the opportunity to both practice tidyverse wrangling and gain new knowledge each time.</p>
<div id="collapsibletree" class="section level1">
<h1>collapsibleTree</h1>
<pre class="r"><code>if (!&quot;collapsibleTree&quot; %in% installed.packages()) {
  install.package(&quot;collapsibleTree&quot;)
}</code></pre>
<p>Load libraries:</p>
<pre class="r"><code>library(tidyverse)
library(collapsibleTree)</code></pre>
<p>Load Data:</p>
<pre class="r"><code>phd_data &lt;- read_csv(&quot;https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-02-19/phd_by_field.csv&quot;)</code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   broad_field = col_character(),
##   major_field = col_character(),
##   field = col_character(),
##   year = col_double(),
##   n_phds = col_double()
## )</code></pre>
<p>Check for missing data:</p>
<pre class="r"><code>sum(is.na(phd_data$n_phds))</code></pre>
<pre><code>## [1] 278</code></pre>
<pre class="r"><code>sum(phd_data$n_phds == 0, na.rm=T)</code></pre>
<pre><code>## [1] 1</code></pre>
<p>If there was no 0 values then would seem sensible to assume the NA values could be re-coded to 0. Best to just remove them in this case, zero by omission.</p>
<div id="a-basic-collapsible-tree-diagram" class="section level2">
<h2>A basic collapsible tree diagram</h2>
<p>The <em>collapsibleTree()</em> function is the workhorse function to produce the plots and a basic version can be produced by simply giving it tidy data and specifying the hierarchy of nodes:</p>
<pre class="r"><code># Broad Field -&gt; Year -&gt; Total
phd_data %&gt;% 
  filter(!is.na(n_phds)) %&gt;% 
  group_by(year, broad_field) %&gt;% 
  summarise(
    total = sum(n_phds)
  ) %&gt;% 
  collapsibleTree(
    c(&quot;broad_field&quot;, &quot;year&quot;, &quot;total&quot;)
  )</code></pre>
<div id="htmlwidget-1" style="width:672px;height:768px;" class="collapsibleTree html-widget"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"data":{"name":".","children":[{"name":"Education","children":[{"name":"2008","children":[{"name":" 6561"}]},{"name":"2009","children":[{"name":" 6528"}]},{"name":"2010","children":[{"name":" 5287"}]},{"name":"2011","children":[{"name":" 4670"}]},{"name":"2012","children":[{"name":" 4803"}]},{"name":"2013","children":[{"name":" 4934"}]},{"name":"2014","children":[{"name":" 4789"}]},{"name":"2015","children":[{"name":" 5098"}]},{"name":"2016","children":[{"name":" 5146"}]},{"name":"2017","children":[{"name":" 4823"}]}]},{"name":"Engineering","children":[{"name":"2008","children":[{"name":" 1364"}]},{"name":"2009","children":[{"name":" 1333"}]},{"name":"2010","children":[{"name":" 1391"}]},{"name":"2011","children":[{"name":" 1525"}]},{"name":"2012","children":[{"name":" 1757"}]},{"name":"2013","children":[{"name":" 2017"}]},{"name":"2014","children":[{"name":" 2191"}]},{"name":"2015","children":[{"name":" 2178"}]},{"name":"2016","children":[{"name":" 2156"}]},{"name":"2017","children":[{"name":" 2227"}]}]},{"name":"Humanities and arts","children":[{"name":"2008","children":[{"name":" 4736"}]},{"name":"2009","children":[{"name":" 4904"}]},{"name":"2010","children":[{"name":" 5015"}]},{"name":"2011","children":[{"name":" 5226"}]},{"name":"2012","children":[{"name":" 5561"}]},{"name":"2013","children":[{"name":" 5715"}]},{"name":"2014","children":[{"name":" 5524"}]},{"name":"2015","children":[{"name":" 5594"}]},{"name":"2016","children":[{"name":" 5480"}]},{"name":"2017","children":[{"name":" 5290"}]}]},{"name":"Life sciences","children":[{"name":"2008","children":[{"name":"18732"}]},{"name":"2009","children":[{"name":"19332"}]},{"name":"2010","children":[{"name":"19005"}]},{"name":"2011","children":[{"name":"19645"}]},{"name":"2012","children":[{"name":"20386"}]},{"name":"2013","children":[{"name":"20892"}]},{"name":"2014","children":[{"name":"21633"}]},{"name":"2015","children":[{"name":"21667"}]},{"name":"2016","children":[{"name":"22354"}]},{"name":"2017","children":[{"name":"22057"}]}]},{"name":"Mathematics and computer sciences","children":[{"name":"2008","children":[{"name":" 3187"}]},{"name":"2009","children":[{"name":" 3163"}]},{"name":"2010","children":[{"name":" 3223"}]},{"name":"2011","children":[{"name":" 3273"}]},{"name":"2012","children":[{"name":" 3496"}]},{"name":"2013","children":[{"name":" 3660"}]},{"name":"2014","children":[{"name":" 3862"}]},{"name":"2015","children":[{"name":" 3818"}]},{"name":"2016","children":[{"name":" 3956"}]},{"name":"2017","children":[{"name":" 3843"}]}]},{"name":"Other","children":[{"name":"2008","children":[{"name":" 2762"}]},{"name":"2009","children":[{"name":" 2807"}]},{"name":"2010","children":[{"name":" 2729"}]},{"name":"2011","children":[{"name":" 2683"}]},{"name":"2012","children":[{"name":" 2734"}]},{"name":"2013","children":[{"name":" 3023"}]},{"name":"2014","children":[{"name":" 3043"}]},{"name":"2015","children":[{"name":" 3020"}]},{"name":"2016","children":[{"name":" 2941"}]},{"name":"2017","children":[{"name":" 3113"}]}]},{"name":"Psychology and social sciences","children":[{"name":"2008","children":[{"name":"10684"}]},{"name":"2009","children":[{"name":"11074"}]},{"name":"2010","children":[{"name":"10978"}]},{"name":"2011","children":[{"name":"11524"}]},{"name":"2012","children":[{"name":"12040"}]},{"name":"2013","children":[{"name":"12129"}]},{"name":"2014","children":[{"name":"12322"}]},{"name":"2015","children":[{"name":"12779"}]},{"name":"2016","children":[{"name":"12829"}]},{"name":"2017","children":[{"name":"12757"}]}]}]},"options":{"hierarchy":["broad_field","year","total"],"input":null,"attribute":"leafCount","linkLength":null,"fontSize":10,"tooltip":false,"collapsed":true,"zoomable":true,"margin":{"top":20,"bottom":20,"left":30,"right":50},"fill":"lightsteelblue"}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="collapsibletreesummary" class="section level2">
<h2>collapsibleTreeSummary()</h2>
<div id="order-nodes-by-total-phds-awarded" class="section level3">
<h3>Order nodes by total PhDs awarded</h3>
<p>Changing to <strong>collapsibleTreeSummary()</strong> instead of collapsibleTree changes the default colors and adds some hover information (number of leaf nodes by default). We can add the attribute argument to use a different metric to the internal weighting which will define the order in which leaves are presented and information in the hover. We can take “total” out of the hierarchy now:</p>
<pre class="r"><code># Broad Field -&gt; Year -&gt; Total
phd_data %&gt;% 
  filter(!is.na(n_phds)) %&gt;% 
  group_by(year, broad_field) %&gt;% 
  summarise(
    total = sum(n_phds)
  ) %&gt;% 
  collapsibleTreeSummary(
    hierarchy = c(&quot;broad_field&quot;, &quot;year&quot;),
    attribute = &quot;total&quot;,
    maxPercent = 50,
    zoomable = F
  )</code></pre>
<div id="htmlwidget-2" style="width:672px;height:768px;" class="collapsibleTree html-widget"></div>
<script type="application/json" data-for="htmlwidget-2">{"x":{"data":{"name":".","fill":"#D33F6A","WeightOfNode":"512,978","children":[{"name":"Life sciences","fill":"#DE6455","WeightOfNode":"205,703","children":[{"name":"2016","fill":"#E8C742","WeightOfNode":"22,354"},{"name":"2017","fill":"#E8C742","WeightOfNode":"22,057"},{"name":"2015","fill":"#E8C742","WeightOfNode":"21,667"},{"name":"2014","fill":"#E8C742","WeightOfNode":"21,633"},{"name":"2013","fill":"#E7CB46","WeightOfNode":"20,892"},{"name":"2012","fill":"#E7CB46","WeightOfNode":"20,386"},{"name":"2011","fill":"#E7CB46","WeightOfNode":"19,645"},{"name":"2009","fill":"#E7CE4C","WeightOfNode":"19,332"},{"name":"2010","fill":"#E7CE4C","WeightOfNode":"19,005"},{"name":"2008","fill":"#E7CE4C","WeightOfNode":"18,732"}]},{"name":"Psychology and social sciences","fill":"#E99F2A","WeightOfNode":"119,116","children":[{"name":"2016","fill":"#E8C742","WeightOfNode":"12,829"},{"name":"2015","fill":"#E8C742","WeightOfNode":"12,779"},{"name":"2017","fill":"#E8C742","WeightOfNode":"12,757"},{"name":"2014","fill":"#E7CB46","WeightOfNode":"12,322"},{"name":"2013","fill":"#E7CB46","WeightOfNode":"12,129"},{"name":"2012","fill":"#E7CB46","WeightOfNode":"12,040"},{"name":"2011","fill":"#E7CB46","WeightOfNode":"11,524"},{"name":"2009","fill":"#E7CE4C","WeightOfNode":"11,074"},{"name":"2010","fill":"#E7CE4C","WeightOfNode":"10,978"},{"name":"2008","fill":"#E7CE4C","WeightOfNode":"10,684"}]},{"name":"Humanities and arts","fill":"#E7CB46","WeightOfNode":"53,045","children":[{"name":"2013","fill":"#E8C742","WeightOfNode":"5,715"},{"name":"2015","fill":"#E8C742","WeightOfNode":"5,594"},{"name":"2012","fill":"#E7CB46","WeightOfNode":"5,561"},{"name":"2014","fill":"#E7CB46","WeightOfNode":"5,524"},{"name":"2016","fill":"#E7CB46","WeightOfNode":"5,480"},{"name":"2017","fill":"#E7CB46","WeightOfNode":"5,290"},{"name":"2011","fill":"#E7CB46","WeightOfNode":"5,226"},{"name":"2010","fill":"#E7CE4C","WeightOfNode":"5,015"},{"name":"2009","fill":"#E7CE4C","WeightOfNode":"4,904"},{"name":"2008","fill":"#E7CE4C","WeightOfNode":"4,736"}]},{"name":"Education","fill":"#E7CB46","WeightOfNode":"52,639","children":[{"name":"2008","fill":"#E8C43D","WeightOfNode":"6,561"},{"name":"2009","fill":"#E8C43D","WeightOfNode":"6,528"},{"name":"2010","fill":"#E7CB46","WeightOfNode":"5,287"},{"name":"2016","fill":"#E7CB46","WeightOfNode":"5,146"},{"name":"2015","fill":"#E7CB46","WeightOfNode":"5,098"},{"name":"2013","fill":"#E7CE4C","WeightOfNode":"4,934"},{"name":"2017","fill":"#E7CE4C","WeightOfNode":"4,823"},{"name":"2012","fill":"#E7CE4C","WeightOfNode":"4,803"},{"name":"2014","fill":"#E7CE4C","WeightOfNode":"4,789"},{"name":"2011","fill":"#E7CE4C","WeightOfNode":"4,670"}]},{"name":"Mathematics and computer sciences","fill":"#E6D457","WeightOfNode":"35,481","children":[{"name":"2016","fill":"#E8C742","WeightOfNode":"3,956"},{"name":"2014","fill":"#E8C742","WeightOfNode":"3,862"},{"name":"2017","fill":"#E8C742","WeightOfNode":"3,843"},{"name":"2015","fill":"#E8C742","WeightOfNode":"3,818"},{"name":"2013","fill":"#E7CB46","WeightOfNode":"3,660"},{"name":"2012","fill":"#E7CB46","WeightOfNode":"3,496"},{"name":"2011","fill":"#E7CE4C","WeightOfNode":"3,273"},{"name":"2010","fill":"#E7CE4C","WeightOfNode":"3,223"},{"name":"2008","fill":"#E7CE4C","WeightOfNode":"3,187"},{"name":"2009","fill":"#E7CE4C","WeightOfNode":"3,163"}]},{"name":"Other","fill":"#E5D75D","WeightOfNode":"28,855","children":[{"name":"2017","fill":"#E8C742","WeightOfNode":"3,113"},{"name":"2014","fill":"#E8C742","WeightOfNode":"3,043"},{"name":"2013","fill":"#E7CB46","WeightOfNode":"3,023"},{"name":"2015","fill":"#E7CB46","WeightOfNode":"3,020"},{"name":"2016","fill":"#E7CB46","WeightOfNode":"2,941"},{"name":"2009","fill":"#E7CB46","WeightOfNode":"2,807"},{"name":"2008","fill":"#E7CB46","WeightOfNode":"2,762"},{"name":"2012","fill":"#E7CE4C","WeightOfNode":"2,734"},{"name":"2010","fill":"#E7CE4C","WeightOfNode":"2,729"},{"name":"2011","fill":"#E7CE4C","WeightOfNode":"2,683"}]},{"name":"Engineering","fill":"#E4DD6B","WeightOfNode":"18,139","children":[{"name":"2017","fill":"#E8C43D","WeightOfNode":"2,227"},{"name":"2014","fill":"#E8C43D","WeightOfNode":"2,191"},{"name":"2015","fill":"#E8C43D","WeightOfNode":"2,178"},{"name":"2016","fill":"#E8C43D","WeightOfNode":"2,156"},{"name":"2013","fill":"#E8C742","WeightOfNode":"2,017"},{"name":"2012","fill":"#E7CB46","WeightOfNode":"1,757"},{"name":"2011","fill":"#E6D151","WeightOfNode":"1,525"},{"name":"2010","fill":"#E6D151","WeightOfNode":"1,391"},{"name":"2008","fill":"#E6D151","WeightOfNode":"1,364"},{"name":"2009","fill":"#E6D457","WeightOfNode":"1,333"}]}]},"options":{"hierarchy":["broad_field","year"],"input":null,"attribute":"total","linkLength":null,"fontSize":10,"tooltip":true,"collapsed":true,"zoomable":false,"margin":{"top":20,"bottom":20,"left":30,"right":45}}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="map-the-size-of-displayed-nodes-to-values-from-a-variable" class="section level2">
<h2>map the size of displayed nodes to values from a variable</h2>
<p>Use the <strong>nodeSize</strong> argument:</p>
<pre class="r"><code># Broad Field -&gt; Year -&gt; Total
phd_data %&gt;% 
  filter(!is.na(n_phds)) %&gt;% 
  group_by(year, broad_field) %&gt;% 
  summarise(
    total = sum(n_phds)
  ) %&gt;% 
  collapsibleTreeSummary(
    hierarchy = c(&quot;broad_field&quot;, &quot;year&quot;),
    attribute = &quot;total&quot;,
    nodeSize = &quot;total&quot;,
    zoomable = F
  )</code></pre>
<div id="htmlwidget-3" style="width:672px;height:768px;" class="collapsibleTree html-widget"></div>
<script type="application/json" data-for="htmlwidget-3">{"x":{"data":{"name":".","fill":"#D33F6A","SizeOfNode":100.47,"WeightOfNode":"512,978","children":[{"name":"Life sciences","fill":"#D33F6A","SizeOfNode":63.62,"WeightOfNode":"205,703","children":[{"name":"2016","fill":"#E9A129","SizeOfNode":20.97,"WeightOfNode":"22,354"},{"name":"2017","fill":"#E9A129","SizeOfNode":20.83,"WeightOfNode":"22,057"},{"name":"2015","fill":"#E9A129","SizeOfNode":20.65,"WeightOfNode":"21,667"},{"name":"2014","fill":"#E9A129","SizeOfNode":20.63,"WeightOfNode":"21,633"},{"name":"2013","fill":"#EAA828","SizeOfNode":20.28,"WeightOfNode":"20,892"},{"name":"2012","fill":"#EAA828","SizeOfNode":20.03,"WeightOfNode":"20,386"},{"name":"2011","fill":"#EAA828","SizeOfNode":19.66,"WeightOfNode":"19,645"},{"name":"2009","fill":"#EAAF29","SizeOfNode":19.5,"WeightOfNode":"19,332"},{"name":"2010","fill":"#EAAF29","SizeOfNode":19.34,"WeightOfNode":"19,005"},{"name":"2008","fill":"#EAAF29","SizeOfNode":19.2,"WeightOfNode":"18,732"}]},{"name":"Psychology and social sciences","fill":"#D54865","SizeOfNode":48.41,"WeightOfNode":"119,116","children":[{"name":"2016","fill":"#E9A129","SizeOfNode":15.89,"WeightOfNode":"12,829"},{"name":"2015","fill":"#E9A129","SizeOfNode":15.86,"WeightOfNode":"12,779"},{"name":"2017","fill":"#E9A129","SizeOfNode":15.84,"WeightOfNode":"12,757"},{"name":"2014","fill":"#EAA828","SizeOfNode":15.57,"WeightOfNode":"12,322"},{"name":"2013","fill":"#EAA828","SizeOfNode":15.45,"WeightOfNode":"12,129"},{"name":"2012","fill":"#EAA828","SizeOfNode":15.39,"WeightOfNode":"12,040"},{"name":"2011","fill":"#EAA828","SizeOfNode":15.06,"WeightOfNode":"11,524"},{"name":"2009","fill":"#EAAF29","SizeOfNode":14.76,"WeightOfNode":"11,074"},{"name":"2010","fill":"#EAAF29","SizeOfNode":14.7,"WeightOfNode":"10,978"},{"name":"2008","fill":"#EAAF29","SizeOfNode":14.5,"WeightOfNode":"10,684"}]},{"name":"Humanities and arts","fill":"#EAA828","SizeOfNode":32.31,"WeightOfNode":"53,045","children":[{"name":"2013","fill":"#E9A129","SizeOfNode":10.6,"WeightOfNode":"5,715"},{"name":"2015","fill":"#E9A129","SizeOfNode":10.49,"WeightOfNode":"5,594"},{"name":"2012","fill":"#EAA828","SizeOfNode":10.46,"WeightOfNode":"5,561"},{"name":"2014","fill":"#EAA828","SizeOfNode":10.43,"WeightOfNode":"5,524"},{"name":"2016","fill":"#EAA828","SizeOfNode":10.38,"WeightOfNode":"5,480"},{"name":"2017","fill":"#EAA828","SizeOfNode":10.2,"WeightOfNode":"5,290"},{"name":"2011","fill":"#EAA828","SizeOfNode":10.14,"WeightOfNode":"5,226"},{"name":"2010","fill":"#EAAF29","SizeOfNode":9.93,"WeightOfNode":"5,015"},{"name":"2009","fill":"#EAAF29","SizeOfNode":9.82,"WeightOfNode":"4,904"},{"name":"2008","fill":"#EAAF29","SizeOfNode":9.65,"WeightOfNode":"4,736"}]},{"name":"Education","fill":"#EAA828","SizeOfNode":32.18,"WeightOfNode":"52,639","children":[{"name":"2008","fill":"#E99A2C","SizeOfNode":11.36,"WeightOfNode":"6,561"},{"name":"2009","fill":"#E99A2C","SizeOfNode":11.33,"WeightOfNode":"6,528"},{"name":"2010","fill":"#EAA828","SizeOfNode":10.2,"WeightOfNode":"5,287"},{"name":"2016","fill":"#EAA828","SizeOfNode":10.06,"WeightOfNode":"5,146"},{"name":"2015","fill":"#EAA828","SizeOfNode":10.02,"WeightOfNode":"5,098"},{"name":"2013","fill":"#EAAF29","SizeOfNode":9.85,"WeightOfNode":"4,934"},{"name":"2017","fill":"#EAAF29","SizeOfNode":9.74,"WeightOfNode":"4,823"},{"name":"2012","fill":"#EAAF29","SizeOfNode":9.72,"WeightOfNode":"4,803"},{"name":"2014","fill":"#EAAF29","SizeOfNode":9.71,"WeightOfNode":"4,789"},{"name":"2011","fill":"#EAAF29","SizeOfNode":9.59,"WeightOfNode":"4,670"}]},{"name":"Mathematics and computer sciences","fill":"#E9BD34","SizeOfNode":26.42,"WeightOfNode":"35,481","children":[{"name":"2016","fill":"#E9A129","SizeOfNode":8.82,"WeightOfNode":"3,956"},{"name":"2014","fill":"#E9A129","SizeOfNode":8.72,"WeightOfNode":"3,862"},{"name":"2017","fill":"#E9A129","SizeOfNode":8.7,"WeightOfNode":"3,843"},{"name":"2015","fill":"#E9A129","SizeOfNode":8.67,"WeightOfNode":"3,818"},{"name":"2013","fill":"#EAA828","SizeOfNode":8.49,"WeightOfNode":"3,660"},{"name":"2012","fill":"#EAA828","SizeOfNode":8.29,"WeightOfNode":"3,496"},{"name":"2011","fill":"#EAAF29","SizeOfNode":8.02,"WeightOfNode":"3,273"},{"name":"2010","fill":"#EAAF29","SizeOfNode":7.96,"WeightOfNode":"3,223"},{"name":"2008","fill":"#EAAF29","SizeOfNode":7.92,"WeightOfNode":"3,187"},{"name":"2009","fill":"#EAAF29","SizeOfNode":7.89,"WeightOfNode":"3,163"}]},{"name":"Other","fill":"#E8C33C","SizeOfNode":23.83,"WeightOfNode":"28,855","children":[{"name":"2017","fill":"#E9A129","SizeOfNode":7.83,"WeightOfNode":"3,113"},{"name":"2014","fill":"#E9A129","SizeOfNode":7.74,"WeightOfNode":"3,043"},{"name":"2013","fill":"#EAA828","SizeOfNode":7.71,"WeightOfNode":"3,023"},{"name":"2015","fill":"#EAA828","SizeOfNode":7.71,"WeightOfNode":"3,020"},{"name":"2016","fill":"#EAA828","SizeOfNode":7.61,"WeightOfNode":"2,941"},{"name":"2009","fill":"#EAA828","SizeOfNode":7.43,"WeightOfNode":"2,807"},{"name":"2008","fill":"#EAA828","SizeOfNode":7.37,"WeightOfNode":"2,762"},{"name":"2012","fill":"#EAAF29","SizeOfNode":7.33,"WeightOfNode":"2,734"},{"name":"2010","fill":"#EAAF29","SizeOfNode":7.33,"WeightOfNode":"2,729"},{"name":"2011","fill":"#EAAF29","SizeOfNode":7.27,"WeightOfNode":"2,683"}]},{"name":"Engineering","fill":"#E6D050","SizeOfNode":18.89,"WeightOfNode":"18,139","children":[{"name":"2017","fill":"#E99A2C","SizeOfNode":6.62,"WeightOfNode":"2,227"},{"name":"2014","fill":"#E99A2C","SizeOfNode":6.57,"WeightOfNode":"2,191"},{"name":"2015","fill":"#E99A2C","SizeOfNode":6.55,"WeightOfNode":"2,178"},{"name":"2016","fill":"#E99A2C","SizeOfNode":6.51,"WeightOfNode":"2,156"},{"name":"2013","fill":"#E9A129","SizeOfNode":6.3,"WeightOfNode":"2,017"},{"name":"2012","fill":"#EAA828","SizeOfNode":5.88,"WeightOfNode":"1,757"},{"name":"2011","fill":"#E9B62D","SizeOfNode":5.48,"WeightOfNode":"1,525"},{"name":"2010","fill":"#E9B62D","SizeOfNode":5.23,"WeightOfNode":"1,391"},{"name":"2008","fill":"#E9B62D","SizeOfNode":5.18,"WeightOfNode":"1,364"},{"name":"2009","fill":"#E9BD34","SizeOfNode":5.12,"WeightOfNode":"1,333"}]}]},"options":{"hierarchy":["broad_field","year"],"input":null,"attribute":"total","linkLength":null,"fontSize":10,"tooltip":true,"collapsed":true,"zoomable":false,"margin":{"top":20,"bottom":20,"left":120.47,"right":45}}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="custom-color-pallete" class="section level2">
<h2>Custom color pallete</h2>
<div id="collapsibletree-1" class="section level3">
<h3>collapsibleTree()</h3>
<p>I wanted an element of gradient-fill within each level. From what I could gather the only way to do this was to carefully construct a vector of colours to fill based on the hierarchy I had specified which I did via the following method (the match between the second/third level main colour could be better if I had more time!):</p>
<pre class="r"><code>phd_data %&gt;% 
  filter(!is.na(n_phds)) %&gt;% 
  group_by(year, broad_field) %&gt;% 
  summarise(
    total = sum(n_phds)
  ) %&gt;% 
  collapsibleTree(
    hierarchy = c(&quot;broad_field&quot;, &quot;year&quot;, &quot;total&quot;),
    fill = 
      c(
        &quot;steelblue4&quot;,
        RColorBrewer::brewer.pal(n = length(unique(.$broad_field)), &quot;Accent&quot;),
        unlist(purrr::map(
          c(&quot;Greens&quot;,&quot;Purples&quot;,&quot;Oranges&quot;,&quot;Greys&quot;,&quot;Blues&quot;,&quot;Reds&quot;,&quot;Blues&quot;),
          function(x) colorRampPalette(RColorBrewer::brewer.pal(n = 9, name = x))(length(unique(.$year)))
        )),
        rep(&quot;#43a3ca&quot;,70)
      ),
    zoomable=F
  )</code></pre>
<div id="htmlwidget-4" style="width:672px;height:768px;" class="collapsibleTree html-widget"></div>
<script type="application/json" data-for="htmlwidget-4">{"x":{"data":{"name":".","fill":"steelblue4","children":[{"name":"Education","fill":"#7FC97F","children":[{"name":"2008","fill":"#F7FCF5","children":[{"name":" 6561","fill":"#43a3ca"}]},{"name":"2009","fill":"#E7F5E2","children":[{"name":" 6528","fill":"#43a3ca"}]},{"name":"2010","fill":"#CDEBC7","children":[{"name":" 5287","fill":"#43a3ca"}]},{"name":"2011","fill":"#ADDEA7","children":[{"name":" 4670","fill":"#43a3ca"}]},{"name":"2012","fill":"#88CD86","children":[{"name":" 4803","fill":"#43a3ca"}]},{"name":"2013","fill":"#5DB86A","children":[{"name":" 4934","fill":"#43a3ca"}]},{"name":"2014","fill":"#37A055","children":[{"name":" 4789","fill":"#43a3ca"}]},{"name":"2015","fill":"#1B843F","children":[{"name":" 5098","fill":"#43a3ca"}]},{"name":"2016","fill":"#00682A","children":[{"name":" 5146","fill":"#43a3ca"}]},{"name":"2017","fill":"#00441B","children":[{"name":" 4823","fill":"#43a3ca"}]}]},{"name":"Engineering","fill":"#BEAED4","children":[{"name":"2008","fill":"#FCFBFD","children":[{"name":" 1364","fill":"#43a3ca"}]},{"name":"2009","fill":"#F0EEF5","children":[{"name":" 1333","fill":"#43a3ca"}]},{"name":"2010","fill":"#DEDEED","children":[{"name":" 1391","fill":"#43a3ca"}]},{"name":"2011","fill":"#C6C6E1","children":[{"name":" 1525","fill":"#43a3ca"}]},{"name":"2012","fill":"#ABA9D0","children":[{"name":" 1757","fill":"#43a3ca"}]},{"name":"2013","fill":"#908DC1","children":[{"name":" 2017","fill":"#43a3ca"}]},{"name":"2014","fill":"#786EB2","children":[{"name":" 2191","fill":"#43a3ca"}]},{"name":"2015","fill":"#65479E","children":[{"name":" 2178","fill":"#43a3ca"}]},{"name":"2016","fill":"#51228D","children":[{"name":" 2156","fill":"#43a3ca"}]},{"name":"2017","fill":"#3F007D","children":[{"name":" 2227","fill":"#43a3ca"}]}]},{"name":"Humanities and arts","fill":"#FDC086","children":[{"name":"2008","fill":"#FFF5EB","children":[{"name":" 4736","fill":"#43a3ca"}]},{"name":"2009","fill":"#FEE7D1","children":[{"name":" 4904","fill":"#43a3ca"}]},{"name":"2010","fill":"#FDD4AB","children":[{"name":" 5015","fill":"#43a3ca"}]},{"name":"2011","fill":"#FDB97D","children":[{"name":" 5226","fill":"#43a3ca"}]},{"name":"2012","fill":"#FD9B50","children":[{"name":" 5561","fill":"#43a3ca"}]},{"name":"2013","fill":"#F77D29","children":[{"name":" 5715","fill":"#43a3ca"}]},{"name":"2014","fill":"#E95E0D","children":[{"name":" 5524","fill":"#43a3ca"}]},{"name":"2015","fill":"#CD4401","children":[{"name":" 5594","fill":"#43a3ca"}]},{"name":"2016","fill":"#A13403","children":[{"name":" 5480","fill":"#43a3ca"}]},{"name":"2017","fill":"#7F2704","children":[{"name":" 5290","fill":"#43a3ca"}]}]},{"name":"Life sciences","fill":"#FFFF99","children":[{"name":"2008","fill":"#FFFFFF","children":[{"name":"18732","fill":"#43a3ca"}]},{"name":"2009","fill":"#F1F1F1","children":[{"name":"19332","fill":"#43a3ca"}]},{"name":"2010","fill":"#DEDEDE","children":[{"name":"19005","fill":"#43a3ca"}]},{"name":"2011","fill":"#C6C6C6","children":[{"name":"19645","fill":"#43a3ca"}]},{"name":"2012","fill":"#A7A7A7","children":[{"name":"20386","fill":"#43a3ca"}]},{"name":"2013","fill":"#868686","children":[{"name":"20892","fill":"#43a3ca"}]},{"name":"2014","fill":"#686868","children":[{"name":"21633","fill":"#43a3ca"}]},{"name":"2015","fill":"#484848","children":[{"name":"21667","fill":"#43a3ca"}]},{"name":"2016","fill":"#202020","children":[{"name":"22354","fill":"#43a3ca"}]},{"name":"2017","fill":"#000000","children":[{"name":"22057","fill":"#43a3ca"}]}]},{"name":"Mathematics and computer sciences","fill":"#386CB0","children":[{"name":"2008","fill":"#F7FBFF","children":[{"name":" 3187","fill":"#43a3ca"}]},{"name":"2009","fill":"#E0ECF7","children":[{"name":" 3163","fill":"#43a3ca"}]},{"name":"2010","fill":"#CBDEF0","children":[{"name":" 3223","fill":"#43a3ca"}]},{"name":"2011","fill":"#ABCFE5","children":[{"name":" 3273","fill":"#43a3ca"}]},{"name":"2012","fill":"#81BADA","children":[{"name":" 3496","fill":"#43a3ca"}]},{"name":"2013","fill":"#58A1CE","children":[{"name":" 3660","fill":"#43a3ca"}]},{"name":"2014","fill":"#3787C0","children":[{"name":" 3862","fill":"#43a3ca"}]},{"name":"2015","fill":"#1B69AF","children":[{"name":" 3818","fill":"#43a3ca"}]},{"name":"2016","fill":"#084D96","children":[{"name":" 3956","fill":"#43a3ca"}]},{"name":"2017","fill":"#08306B","children":[{"name":" 3843","fill":"#43a3ca"}]}]},{"name":"Other","fill":"#F0027F","children":[{"name":"2008","fill":"#FFF5F0","children":[{"name":" 2762","fill":"#43a3ca"}]},{"name":"2009","fill":"#FEE2D5","children":[{"name":" 2807","fill":"#43a3ca"}]},{"name":"2010","fill":"#FCC3AB","children":[{"name":" 2729","fill":"#43a3ca"}]},{"name":"2011","fill":"#FC9F81","children":[{"name":" 2683","fill":"#43a3ca"}]},{"name":"2012","fill":"#FB7B5B","children":[{"name":" 2734","fill":"#43a3ca"}]},{"name":"2013","fill":"#F5553C","children":[{"name":" 3023","fill":"#43a3ca"}]},{"name":"2014","fill":"#E32F27","children":[{"name":" 3043","fill":"#43a3ca"}]},{"name":"2015","fill":"#C2161B","children":[{"name":" 3020","fill":"#43a3ca"}]},{"name":"2016","fill":"#9E0D14","children":[{"name":" 2941","fill":"#43a3ca"}]},{"name":"2017","fill":"#67000D","children":[{"name":" 3113","fill":"#43a3ca"}]}]},{"name":"Psychology and social sciences","fill":"#BF5B17","children":[{"name":"2008","fill":"#F7FBFF","children":[{"name":"10684","fill":"#43a3ca"}]},{"name":"2009","fill":"#E0ECF7","children":[{"name":"11074","fill":"#43a3ca"}]},{"name":"2010","fill":"#CBDEF0","children":[{"name":"10978","fill":"#43a3ca"}]},{"name":"2011","fill":"#ABCFE5","children":[{"name":"11524","fill":"#43a3ca"}]},{"name":"2012","fill":"#81BADA","children":[{"name":"12040","fill":"#43a3ca"}]},{"name":"2013","fill":"#58A1CE","children":[{"name":"12129","fill":"#43a3ca"}]},{"name":"2014","fill":"#3787C0","children":[{"name":"12322","fill":"#43a3ca"}]},{"name":"2015","fill":"#1B69AF","children":[{"name":"12779","fill":"#43a3ca"}]},{"name":"2016","fill":"#084D96","children":[{"name":"12829","fill":"#43a3ca"}]},{"name":"2017","fill":"#08306B","children":[{"name":"12757","fill":"#43a3ca"}]}]}]},"options":{"hierarchy":["broad_field","year","total"],"input":null,"attribute":"leafCount","linkLength":null,"fontSize":10,"tooltip":false,"collapsed":true,"zoomable":false,"margin":{"top":20,"bottom":20,"left":30,"right":50}}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="collapsibletreesummary-1" class="section level2">
<h2>collapsibleTreeSummary()</h2>
<p>The way colouring works is different in the <strong>summary()</strong> wrapper. I couldn’t quickly work out a way to do the same within-level gradient fill as previously. Any tips on how to do that would be great.</p>
<pre class="r"><code>phd_data %&gt;% 
  filter(!is.na(n_phds)) %&gt;% 
  group_by(year, broad_field) %&gt;% 
  summarise(
    total = sum(n_phds)
  ) %&gt;% 
  collapsibleTreeSummary(
    hierarchy = c(&quot;broad_field&quot;, &quot;year&quot;),
    attribute = &quot;total&quot;,
    fillFun = colorspace::heat_hcl,
    percentOfParent = TRUE,
    zoomable=F,
    nodeSize = &quot;total&quot;
  )</code></pre>
<div id="htmlwidget-5" style="width:672px;height:768px;" class="collapsibleTree html-widget"></div>
<script type="application/json" data-for="htmlwidget-5">{"x":{"data":{"name":".","fill":"#D33F6A","SizeOfNode":100.47,"WeightOfNode":"100%","children":[{"name":"Life sciences","fill":"#D33F6A","SizeOfNode":63.62,"WeightOfNode":"40.1%","children":[{"name":"2016","fill":"#E9A129","SizeOfNode":20.97,"WeightOfNode":"10.87%"},{"name":"2017","fill":"#E9A129","SizeOfNode":20.83,"WeightOfNode":"10.72%"},{"name":"2015","fill":"#E9A129","SizeOfNode":20.65,"WeightOfNode":"10.53%"},{"name":"2014","fill":"#E9A129","SizeOfNode":20.63,"WeightOfNode":"10.52%"},{"name":"2013","fill":"#EAA828","SizeOfNode":20.28,"WeightOfNode":"10.16%"},{"name":"2012","fill":"#EAA828","SizeOfNode":20.03,"WeightOfNode":"9.91%"},{"name":"2011","fill":"#EAA828","SizeOfNode":19.66,"WeightOfNode":"9.55%"},{"name":"2009","fill":"#EAAF29","SizeOfNode":19.5,"WeightOfNode":"9.4%"},{"name":"2010","fill":"#EAAF29","SizeOfNode":19.34,"WeightOfNode":"9.24%"},{"name":"2008","fill":"#EAAF29","SizeOfNode":19.2,"WeightOfNode":"9.11%"}]},{"name":"Psychology and social sciences","fill":"#D54865","SizeOfNode":48.41,"WeightOfNode":"23.22%","children":[{"name":"2016","fill":"#E9A129","SizeOfNode":15.89,"WeightOfNode":"10.77%"},{"name":"2015","fill":"#E9A129","SizeOfNode":15.86,"WeightOfNode":"10.73%"},{"name":"2017","fill":"#E9A129","SizeOfNode":15.84,"WeightOfNode":"10.71%"},{"name":"2014","fill":"#EAA828","SizeOfNode":15.57,"WeightOfNode":"10.34%"},{"name":"2013","fill":"#EAA828","SizeOfNode":15.45,"WeightOfNode":"10.18%"},{"name":"2012","fill":"#EAA828","SizeOfNode":15.39,"WeightOfNode":"10.11%"},{"name":"2011","fill":"#EAA828","SizeOfNode":15.06,"WeightOfNode":"9.67%"},{"name":"2009","fill":"#EAAF29","SizeOfNode":14.76,"WeightOfNode":"9.3%"},{"name":"2010","fill":"#EAAF29","SizeOfNode":14.7,"WeightOfNode":"9.22%"},{"name":"2008","fill":"#EAAF29","SizeOfNode":14.5,"WeightOfNode":"8.97%"}]},{"name":"Humanities and arts","fill":"#EAA828","SizeOfNode":32.31,"WeightOfNode":"10.34%","children":[{"name":"2013","fill":"#E9A129","SizeOfNode":10.6,"WeightOfNode":"10.77%"},{"name":"2015","fill":"#E9A129","SizeOfNode":10.49,"WeightOfNode":"10.55%"},{"name":"2012","fill":"#EAA828","SizeOfNode":10.46,"WeightOfNode":"10.48%"},{"name":"2014","fill":"#EAA828","SizeOfNode":10.43,"WeightOfNode":"10.41%"},{"name":"2016","fill":"#EAA828","SizeOfNode":10.38,"WeightOfNode":"10.33%"},{"name":"2017","fill":"#EAA828","SizeOfNode":10.2,"WeightOfNode":"9.97%"},{"name":"2011","fill":"#EAA828","SizeOfNode":10.14,"WeightOfNode":"9.85%"},{"name":"2010","fill":"#EAAF29","SizeOfNode":9.93,"WeightOfNode":"9.45%"},{"name":"2009","fill":"#EAAF29","SizeOfNode":9.82,"WeightOfNode":"9.24%"},{"name":"2008","fill":"#EAAF29","SizeOfNode":9.65,"WeightOfNode":"8.93%"}]},{"name":"Education","fill":"#EAA828","SizeOfNode":32.18,"WeightOfNode":"10.26%","children":[{"name":"2008","fill":"#E99A2C","SizeOfNode":11.36,"WeightOfNode":"12.46%"},{"name":"2009","fill":"#E99A2C","SizeOfNode":11.33,"WeightOfNode":"12.4%"},{"name":"2010","fill":"#EAA828","SizeOfNode":10.2,"WeightOfNode":"10.04%"},{"name":"2016","fill":"#EAA828","SizeOfNode":10.06,"WeightOfNode":"9.78%"},{"name":"2015","fill":"#EAA828","SizeOfNode":10.02,"WeightOfNode":"9.68%"},{"name":"2013","fill":"#EAAF29","SizeOfNode":9.85,"WeightOfNode":"9.37%"},{"name":"2017","fill":"#EAAF29","SizeOfNode":9.74,"WeightOfNode":"9.16%"},{"name":"2012","fill":"#EAAF29","SizeOfNode":9.72,"WeightOfNode":"9.12%"},{"name":"2014","fill":"#EAAF29","SizeOfNode":9.71,"WeightOfNode":"9.1%"},{"name":"2011","fill":"#EAAF29","SizeOfNode":9.59,"WeightOfNode":"8.87%"}]},{"name":"Mathematics and computer sciences","fill":"#E9BD34","SizeOfNode":26.42,"WeightOfNode":"6.92%","children":[{"name":"2016","fill":"#E9A129","SizeOfNode":8.82,"WeightOfNode":"11.15%"},{"name":"2014","fill":"#E9A129","SizeOfNode":8.72,"WeightOfNode":"10.88%"},{"name":"2017","fill":"#E9A129","SizeOfNode":8.7,"WeightOfNode":"10.83%"},{"name":"2015","fill":"#E9A129","SizeOfNode":8.67,"WeightOfNode":"10.76%"},{"name":"2013","fill":"#EAA828","SizeOfNode":8.49,"WeightOfNode":"10.32%"},{"name":"2012","fill":"#EAA828","SizeOfNode":8.29,"WeightOfNode":"9.85%"},{"name":"2011","fill":"#EAAF29","SizeOfNode":8.02,"WeightOfNode":"9.22%"},{"name":"2010","fill":"#EAAF29","SizeOfNode":7.96,"WeightOfNode":"9.08%"},{"name":"2008","fill":"#EAAF29","SizeOfNode":7.92,"WeightOfNode":"8.98%"},{"name":"2009","fill":"#EAAF29","SizeOfNode":7.89,"WeightOfNode":"8.91%"}]},{"name":"Other","fill":"#E8C33C","SizeOfNode":23.83,"WeightOfNode":"5.62%","children":[{"name":"2017","fill":"#E9A129","SizeOfNode":7.83,"WeightOfNode":"10.79%"},{"name":"2014","fill":"#E9A129","SizeOfNode":7.74,"WeightOfNode":"10.55%"},{"name":"2013","fill":"#EAA828","SizeOfNode":7.71,"WeightOfNode":"10.48%"},{"name":"2015","fill":"#EAA828","SizeOfNode":7.71,"WeightOfNode":"10.47%"},{"name":"2016","fill":"#EAA828","SizeOfNode":7.61,"WeightOfNode":"10.19%"},{"name":"2009","fill":"#EAA828","SizeOfNode":7.43,"WeightOfNode":"9.73%"},{"name":"2008","fill":"#EAA828","SizeOfNode":7.37,"WeightOfNode":"9.57%"},{"name":"2012","fill":"#EAAF29","SizeOfNode":7.33,"WeightOfNode":"9.47%"},{"name":"2010","fill":"#EAAF29","SizeOfNode":7.33,"WeightOfNode":"9.46%"},{"name":"2011","fill":"#EAAF29","SizeOfNode":7.27,"WeightOfNode":"9.3%"}]},{"name":"Engineering","fill":"#E6D050","SizeOfNode":18.89,"WeightOfNode":"3.54%","children":[{"name":"2017","fill":"#E99A2C","SizeOfNode":6.62,"WeightOfNode":"12.28%"},{"name":"2014","fill":"#E99A2C","SizeOfNode":6.57,"WeightOfNode":"12.08%"},{"name":"2015","fill":"#E99A2C","SizeOfNode":6.55,"WeightOfNode":"12.01%"},{"name":"2016","fill":"#E99A2C","SizeOfNode":6.51,"WeightOfNode":"11.89%"},{"name":"2013","fill":"#E9A129","SizeOfNode":6.3,"WeightOfNode":"11.12%"},{"name":"2012","fill":"#EAA828","SizeOfNode":5.88,"WeightOfNode":"9.69%"},{"name":"2011","fill":"#E9B62D","SizeOfNode":5.48,"WeightOfNode":"8.41%"},{"name":"2010","fill":"#E9B62D","SizeOfNode":5.23,"WeightOfNode":"7.67%"},{"name":"2008","fill":"#E9B62D","SizeOfNode":5.18,"WeightOfNode":"7.52%"},{"name":"2009","fill":"#E9BD34","SizeOfNode":5.12,"WeightOfNode":"7.35%"}]}]},"options":{"hierarchy":["broad_field","year"],"input":null,"attribute":"total","linkLength":null,"fontSize":10,"tooltip":true,"collapsed":true,"zoomable":false,"margin":{"top":20,"bottom":20,"left":120.47,"right":45}}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="conclusion" class="section level1">
<h1>Conclusion</h1>
<p>Perhaps not the most sensible way to visualise the data here but an interesting visualisation tool to know about and have ‘in the locker’ for other problems down the line. Particularly useful when the volume of data needed to visualise is particularly large and a more concise alternative doesn’t exist given how easy it is to produce the collapsible elements.</p>
</div>
